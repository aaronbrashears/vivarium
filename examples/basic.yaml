---
contents:
  basic:
    etc.hosts: |
      127.0.0.1	localhost
      127.0.1.1	${HOST.SHORT}

      # The following lines are desirable for IPv6 capable hosts
      ::1     localhost ip6-localhost ip6-loopback
      fe00::0 ip6-localnet
      ff00::0 ip6-mcastprefix
      ff02::1 ip6-allnodes
      ff02::2 ip6-allrouters
      ff02::3 ip6-allhosts
    apt:
      sources: |
        deb http://us.archive.ubuntu.com/ubuntu/ lucid main restricted
        deb-src http://us.archive.ubuntu.com/ubuntu/ lucid main restricted
        deb http://us.archive.ubuntu.com/ubuntu/ lucid-updates main restricted
        deb-src http://us.archive.ubuntu.com/ubuntu/ lucid-updates main restricted
        deb http://us.archive.ubuntu.com/ubuntu/ lucid universe
        deb-src http://us.archive.ubuntu.com/ubuntu/ lucid universe
        deb http://us.archive.ubuntu.com/ubuntu/ lucid-updates universe
        deb-src http://us.archive.ubuntu.com/ubuntu/ lucid-updates universe
files:
  etc:
    apache2:
      modules-enabled: |
        location: /etc/apache2/mods-enabled
        files:
          proxy.load: { 'target' : '../mods-available/proxy.load' }
          proxy.conf: { 'target' : '../mods-available/proxy.conf' }
      sites-enabled: |
        location: /etc/apache2/sites-enabled
        files:
          default: { 'target' : '../sites-available/default' }
          default-ssl: { 'target' : '../sites-available/default-ssl' }
    apt.sources: |
      location: /etc/apt/sources.list
      owner: root
      group: root
      mode: u=rw,go=r
      content: /basic/apt/sources
  etc.hosts: |
    location: /etc/hosts
    owner: root
    group: root
    mode: u=rw,go=r
    template: /basic/etc.hosts
includes:
  basic.host: |
    targets:
      basic-host:
        steps:
          - action: install
            files: [/etc.hosts]
          - action: install
            packages: [postfix, mailutils]
# Proposed alternate syntax:
#          - 'install(file=etc.hosts, packages=[postfix, mailutils])'
hosts:
  com:
    example:
      www: |
        includes: [ /basic.host ]
        roles:
          www: ~
  com:
    example:
      office:
        gonzo: |
          roles:
            dev: ~
presence:
roles:
  dev: |
    targets:
      universe:
        steps:
          - action: install
            files: [ /etc/apt.sources ]
          - action: run
            command: [ aptitude, update ]
      ruby-dev:
        depends: [ universe ]
        steps:
          - action: install
            packages: [ rubygems ]
          - action: install
            gems: [ { name: rake, version: 0.8.7 } ]
  www: |
    targets:
      apache:
        steps:
          - action: install
            packages: [apache2, libapache2-mod-proxy-html]
          - action: install
            files:
              - /etc/apache2/modules-enabled
              - /etc/apache2/sites-enabled
        depends: [ basic-host ]
# Proposed alternate syntax:
#       actions:[ 'install(packages=[apache, libapache2-mod-proxy-html])' ]
